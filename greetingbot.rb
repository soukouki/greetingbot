
client_id = ARGV[0].to_i
token = ARGV[1]

require "discordrb"
require "moji"

def find_case cases, text
	cases.find{|hash|
		(hash[:r] =~ Moji.kata_to_hira(text).tr("A-Z", "a-z"))
	}
end

def greeting cases
	find_case(cases, "ã“ã‚“")[:res].(Time.now).sample
end

bot = Discordrb::Bot.new(token: token, client_id: client_id)

def roughly_time_to_s time
	hour = time.hour % 12
	nexthour = (time.hour+1) % 12
	(case time.hour
	when 4..5
		"æ—©æœ"
	when 6..9
		"æœ"
	when 10..11
		"æ˜¼å‰"
	when 12..14
		"æ˜¼"
	when 15..16
		"æ˜¼éã"
	when 17..18
		"å¤•æ–¹"
	when 19..23
		"å¤œ"
	when 0..3
		"æ·±å¤œ"
	end + "ã®" + case time.min
	when 0..1
		"#{hour}æ™‚ã¡ã‚‡ã†ã©"
	when 2..5
		"#{hour}æ™‚"
	when 6..11
		"#{hour}æ™‚ã™ã"
	when 12..18
		"#{hour}æ™‚15åˆ†"
	when 19..24
		"#{hour}æ™‚åŠã¾ãˆ"
	when 25..27
		"#{hour}æ™‚åŠ"
	when 28..32
		"#{hour}æ™‚åŠã¡ã‚‡ã†ã©"
	when 33..35
		"#{hour}æ™‚åŠ"
	when 36..41
		"#{hour}æ™‚åŠã™ã"
	when 42..48
		"#{hour}æ™‚45åˆ†"
	when 49..54
		"#{nexthour}æ™‚ã¾ãˆ"
	when 55..58
		"#{nexthour}æ™‚"
	when 59..60
		"#{nexthour}æ™‚ã¡ã‚‡ã†ã©"
	end).tr("0-9", "ï¼-ï¼™")
end

nobi = /[ãƒ¼ï½ããƒã…ã‡ã‰ã£ï¼ï¼Ÿ\-=!?]+/
sink = /[ãƒ¼ï½ã€ã€‚ãƒ»,.ï¼ï¼Ÿ\-=!?]+/
na = ->{
	["ãƒãƒ­ãƒ­ãƒ¼ã‚¹ï¼"]+
	((rand(2)==0)? ["ãªãƒ¼", "ãªãƒ¼ï¼"] : [])+
	((rand(6)==0)? ["ãƒãƒ­ãƒ­ãƒ­ãƒ¼ã‚¹ï¼"] : [])+ # ã™ã„ã¾ã›ã‚“èª¿å­ä¹—ã‚Šã¾ã—ãŸ
	((rand(10)==0)? ["ãƒãƒ ãƒ­ãƒ¼ã‚¹ï¼"] : [])+
	((rand(30)==0)? ["è±šãƒ­ãƒ¼ã‚¹ï¼"] : [])+
	((rand(100)==0)? ["ãƒ­ãƒ¼ã‚¹ã‹ã¤ä¸¼"] : [])+
	[]
}
morning = ->{
	["ãŠã¯ã‚ˆã†ã§ã™ãƒ¼", "ã‚ã€ãŠã¯ã‚ˆã†ã§ã™ãƒ¼", "ãŠã£ã¯ãƒ¼", "ãŠã¯ãƒ¼"]+
	na.()
}
daytime = ->{
	["ã‚ã€ã“ã‚“", "ã“ã‚“ã§ã™ãƒ¼", "ã“ã‚“ã«ã¡ã¯ãƒ¼", "ã‚„ã£ã¯ã‚ãƒ¼"]+
	((rand(6)==0)? ["cons"] : [])+
	na.()
}
night = ->{
	["ã‚ã€ã“ã‚“ã§ã™ãƒ¼", "ã“ã‚“ã°ã‚“ã¯ãƒ¼"]+
	((rand(4)==0)? ["ã“ã‚“ã°ã‚“ã‚ã«", "ã“ã‚“ã°ã‚“ã‚ã‚“ã“"] : [])+ # å¤§ä½“1/3
	na.()
}
good_night = ->{
	["ãŠã‚„ã™ã¿ã§ã™ãƒ¼", "ãŠã‚„ã™ã¿ãªã•ã„ã§ã™ãƒ¼", "ãŠã¤ã§ã™ã€‚ãŠã‚„ã™ã¿ã§ã™ãƒ¼", "ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼"]+
	((rand(3)==0)? ["ãŠã‚„ã™ã¿ã‚“ã¿ã‚“ãœã¿ãƒ¼"] : [])
}
late_night_drop = ->{
	good_night.().select{rand(2)==0}+
	["é•·æ™‚é–“ãŠç–²ã‚Œæ§˜ã§ã™ãƒ¼ï¼", ".....:zzz:"]
}
cases = [
	{r:/ãŠã£?ã¯($|#{nobi}|ã‚ˆ)/o, skip:60,
		res:->(t){
			case t.hour
			when 4..10
				morning.()
			when 11..12
				["ãŠãã‚ˆãƒ¼ã€ã‚‚ã†#{roughly_time_to_s(t)}ã§ã™ã‚ˆãƒ¼", "ãŠãã‚ˆã†ã§ã™ãƒ¼"]+na.().select{rand(1)==0}
			when 13..15
				["ã‚‚ã†æ˜¼éãã§ã™ã‚ˆãƒ¼", "ãŠãã‚ˆã†ã§ã™ãƒ¼"]+na.().select{rand(1)==0}
			when 16..17
				["ã‚‚ã†å¤•æ–¹ã§ã™ã‚ˆãƒ¼", "ãˆã£ã¨ã€ä»Šã¯#{roughly_time_to_s(t)}ã§ã™ãŒãƒ»ãƒ»"]+na.().select{rand(1)==0}
			else
				["ãˆã£ã¨ã€ä»Šã¯å¤œã§ã™ã‚ˆãƒ»ãƒ»ï¼Ÿã¾ã•ã‹ãƒ»ãƒ»ãƒ»", "ãˆã£ã¨ã€ä»Šã¯#{roughly_time_to_s(t)}ã§ã™ãŒãƒ»ãƒ»"]+na.().select{rand(1)==0}
			end}},
	{r:/
		ã“ã‚“(#{nobi}|ã«?(ã¡|#{nobi})|ã§ã™)|(^|#{nobi}|#{sink})ã“ã‚“$|
		(^|#{sink})ã©(ã†|#{nobi}|)ã‚‚|
		^.{,5}(hello|ã¯ã‚).{,5}$|
		^(hi#{sink}?|ã²)$|
		^ã¡[ã‚ã¯]/xo, skip:60,
		res:->(t){
			case t.hour
			when 9..16
				daytime.()
			when 17..23, 0..3
				night.()
			else
				morning.()
			end}},
	{r:/ã“ã‚“ã°#{nobi}?$|ã°ã‚“(ã‚|ã¯|#{nobi})/o, skip:60,
		res:->(t){
			case t.hour
			when 16..23, 0..3
				night.()
			when 4..9
				["ã‚‚ã†æœã§ã™ãƒ¼", "ã‚‚ã†#{roughly_time_to_s(t)}ã§ã™ã‚ˆãƒ¼"]+na.().select{rand(1)==0}
			else
				["ã‚‚ã†æ˜¼ã§ã™ãƒ¼ï¼", "#{roughly_time_to_s(t)}ã§ã™ã‚ˆãƒ¼ï¼"]+na.().select{rand(1)==0}
			end}},
	{r:/(ã§ã¯|ã˜ã‚ƒ(ã|ã‚|))(ãŠã¤|ä¹™)|(?<!ãŒ)(è½|ãŠ)ã¡($|ã¾|ã‚‹([ã‚ã­ã‹]))|^(è½|ãŠ)ã¡ã‚‹/o, skip:0, # è¿”äº‹ã®ã“ã¨ã‚’è€ƒãˆã¦
		res:->(t){
			case t.hour
			when 21..23, 0..1
				good_night.()
			when 2..5
				late_night_drop.()
			else
				["ã‚ã€ä¹™ã§ã™ãƒ¼", "ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼", "ä¹™ãƒ¼", "ãŠã¤ã§ã™ãƒ¼ï¼"]
			end}},
	{r:/
		((?<![ã§])å¯|(^|#{nobi}|#{sink})ã­)(ã¾ã™|ã‚ˆ|ã¦(?!ã‚‹(?!ãƒ¼|ã­|$))|ã‚‹(ã­(?!ã‚‹)|#{nobi}|$))|
		ãŠ(ã‚„ã™|ä¼‘)ã¿|(çœ |ã­ã‚€)([ã‚Šã‚‹]|ã„(?!ã‘))|ğŸ’¤/xo, skip:60,
		res:->(t){
			case t.hour
			when 20..23, 0..1
				good_night.()+["ã‚ã€ãŠã‚„ã™ã¿ã§ã™ãƒ¼", "è‡ªåˆ†ã¯ã¾ã èµ·ãã¦ã¾ã™ã­ãƒ¼"]
			when 2..8
				late_night_drop.()
			when 9..15
				["ãˆã£ã¨ã€æ˜¼ã§ã™ã‚ˆï¼Ÿ", "ãˆã£ã¨ã€ã¾ã #{roughly_time_to_s(t)}ã§ã™ã‚ˆãƒ»ãƒ»ï¼Ÿ"]
			when 16..19
				["ãˆã£ã¨ã€ã¾ã å¤•æ–¹ã§ã™ã‚ˆï¼Ÿ", "ãˆã£ã¨ã€ã¾ã #{roughly_time_to_s(t)}ã§ã™ã‚ˆãƒ»ãƒ»ï¼Ÿ"]
			end}},
	{r:/
		(?<!ã„)(ã¤ã‹|ç–²)ã‚Œ[ãŸã¾]|
		(?<!ã‚‰)ãŠ(ç–²|ã¤ã‹)ã‚Œ(?!ã®)|
		(^|ã¯|#{nobi})(ä¹™|ãŠã¤)($|ã§|ã‹|ã—|#{nobi})/xo, skip:60,
		res:->(t){
			case t.hour
			when 9..23
				["ãŠã¤ã‹ã‚Œã•ã¾ã§ã™ï¼", "ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼", "ãŠã¤ã§ã™"]
			when 0..8
				["é…ãã¾ã§ãŠã¤ã‹ã‚Œã•ã¾ã§ã™ï¼", "é…ãã¾ã§ãŠç–²ã‚Œæ§˜ã§ã™ï¼", "ãŠã¤ã‹ã‚Œã•ã¾ã§ã™ã€ãŠã‚„ã™ã¿ã§ã™"]
			end
			}},
	{r:/(åˆ|ã¯ã˜)ã‚ã¾ã—ã¦/o, skip:300, # æŒ¨æ‹¶ã¯è‹¥å¹²é…ã‚Œã¦ã‚‚ã‚„ã‚‹ã¨æ€ã†ã®ã§ã€skip:ã¯é•·ã‚
		res:->(t){["ã¯ã£ã˜ã‚ã¾ã£ã—ã¦ãƒ¼ï¼", "åˆã‚ã¾ã—ã¦ãƒ¼", "ã¯ã˜ã‚ã¾ã—ã¦ã§ã™ãƒ¼"]+na.().select{rand(2)==0}}},
	{r:/ãŸã ã„?ã¾(?![ã¯ã‹ã¨])|(ã‚‚ã©|ã‚‚ã£ã©|æˆ»)(ã‚Š($|ã |ã§|ã¾ã—|#{nobi})|#{nobi}?$)/o, skip:0,
		res:->(t){["ã‚ã€ãŠã‹ãˆã‚Šã§ã™ãƒ¼", "ãŠã‹ãˆã‚Šã§ã™ãƒ¼", "ãŠã‹ã‹ãƒ¼"]}},
	{r:/
		((^|[ã«ã‚‰ã¯]|#{sink}|#{nobi})(?<!ã§)ã„|(?<!ã©ã†ã‚„ã£ã¦|ãã‚‰ã„|å¾Œ|æ—¥|ã§)è¡Œ)
			(ã|ãã‚‹|ã£?ã¦(ãã‚‹|ã(ã¾|$))|ã(?![ã‘ã«ã‚‰ã¨ã¤ã®]|ã‹(?!ãª(?!#{nobi})|$|#{sink}|#{nobi})))|
		(ã¨ã„ã‚Œ|ãŠ(æ‰‹|ã¦)(æ´—|ã‚ã‚‰)ã„|ãŠ(èŠ±|ã¯ãª)(æ‘˜|ã¤)ã¿|(é›‰|ãã˜)((æ’ƒ|ã†)ã¡|(ç‹©|ãŒ|ã‹)ã‚Š))#{nobi}?#{sink}?$|
		(å‡º|ã§)ã‹ã‘ã¦/xo, skip:0,
		res:->(t){["ã‚ã€ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„ã§ã™ãƒ¼", "ã„ã£ã¦ã‚‰ã§ã™ãƒ¼", "ã‚ãƒ¼ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„ã§ã™ãƒ¼"]}},
	{r:/\A\^\^\#\z/o, skip:0,
		res:->(t){["ã‹ã‚ã„ã„ã«ã‚ƒ"]}},
	{r:/\Aã›ã‚„\z/o, skip:0,
		res:->(t){["ãªãƒ¼\n\n\tãƒ»ãƒ»ãƒ»ã“ã‚Œã§ã„ã„ï¼Ÿ"]}},
	{r:/(ä»Š|ã„#{nobi}?ã¾)#{nobi}?ã¯?#{nobi}?(ä½•|ãª#{nobi}?ã‚“)#{nobi}?(æ™‚|ã˜)/o, skip:0,
		res:->(t){["#{roughly_time_to_s(t)}ã§ã™ãƒ¼\n`#{t}`"]}},
	{r:/(ä»Š|ã„#{nobi}?ã¾|ä»Šæ—¥|ã#{nobi}?ã‚‡#{nobi}?ã†)ã¯?#{nobi}?(ä½•|ãª#{nobi}?ã‚“)#{nobi}?(æ—¥|ã«#{nobi}?ã¡)/o, skip:0,
		res:->(t){["ä»Šæ—¥ã¯#{t.day}æ—¥ã§ã™ãƒ¼\n`#{t}`"]}},
	{r:/<@#{client_id}>/o, skip:0, # ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³
		res:->(t){
			helpmsg = "ã‚³ãƒãƒ³ãƒ‰ã®ä¸€è¦§ãªã‚‰`n.help`ã ã‚ˆãƒ¼"
			case t.hour
			when 2..5
				[
					"ãµã«ã‚ƒãƒ¼ãƒ»ãƒ»ï¼Ÿ\n#{helpmsg}ã‚’ã¿ã¦ãƒ»ãƒ». . :zzz:", # åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã¯ãƒ‡ã‚£ã‚¹ã‚³ãƒ¼ãƒ‰ä¸Šã§ã¯ã‹ãªã‚Šå°ã•ãè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚
					". . . . :zzz: (ã‚‚ã†ä¸€åº¦å‘¼ã‚“ã§ã¿ã¾ã—ã‚‡ã†)\n(ã‚³ãƒãƒ³ãƒ‰ã®ä¸€è¦§ã¯`n.help`ã§è¦‹ã‚Œã¾ã™)",
				]
			when 23, 0..10
				["ãµã«ã‚ƒãƒ¼ãƒ»ãƒ»ï¼Ÿ\n#{helpmsg}ãƒ»ãƒ». . :zzz:"]
			when 11..22
				["ã“ã‚“ãƒ¼ãƒ»ãƒ»\n#{helpmsg}"]
			end}},
	{r:/^n\.help$/o, skip:0,
		res:->(t){[
			"#{greeting(cases)} Command List\n"+
			"`n.help` : ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚\n"+
			"`n.info` : ã“ã®botã®ã“ã¨ã‚’æ•™ãˆã¦ãã‚Œã¾ã™ã€‚æ‹›å¾…URLã‚‚ã“ã¡ã‚‰ã‹ã‚‰ã€‚\n"+
			"`n.test` : ãƒœãƒƒãƒˆã®è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n"+
			"\n`ã“ã‚“` ã¨å…¥åŠ›ã—ã¦ã¿ã‚‹ã¨ï¼Ÿ"]}},
	{r:/^n\.info$/o, skip:0,
		res:->(t){
			(
				[
					"`@sou7#0094`(soukouki)ãŒä½œã£ãŸbotã§ã™ãƒ¼ã€‚",
					"ãŠã¯ã‚ˆã†ã€ã“ã‚“ã«ã¡ã¯ã€è½ã¡ã¾ã™ã€ãŠã‚„ã™ã¿ã€åˆã‚ã¾ã—ã¦ã€ãŸã ã„ã¾ã€è¡Œã£ã¦ãã¾ã™ ã„ã¾ä½•æ™‚ï¼Ÿ ä»Šæ—¥ä½•æ—¥ï¼Ÿ ã«å¯¾å¿œã—ã¦ã¾ã™ã€‚",
					"`^^#` `ã›ã‚„`", "é€£ç¶šã ã¨åå¿œã—ãªã„ã‚ˆã†ã«ã—ã¦ã‚ã‚‹ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚",
					"`d-æ•°å­—ãŠã¯ã‚ˆã†`ã§ãã®æ™‚é–“ã®è¿”äº‹ãŒèã‘ã¾ã™ã€‚",
				]+
				["æ‹›å¾…URLã¯ã“ã¡ã‚‰ï¼ https://discordapp.com/oauth2/authorize?client_id=394876010438328321&scope=bot&permissions=2048"]*2
			)
				.map{|s|((rand(2)==0)? greeting(cases)+"ã€‚" : "")+s} # TODO : é€£ç¶šæ’é™¤ãŒã†ã¾ãåƒã‹ãªããªã‚‹ã€‚å¾Œå‡¦ç†ã‚’ã¤ã‘ã‚Œã°ã„ã„ã‹ãªï¼Ÿ
		}},
	{r:/^n\.test$/o, skip:0,
		res:->(t){
			puts "(ãƒ†ã‚¹ãƒˆé–‹å§‹)"
			# {"ãƒ†ã‚¹ãƒˆã™ã‚‹æ–‡å­—åˆ—", ãƒãƒƒãƒã™ã‚‹ã‹ã©ã†ã‹(boolean)}
			testcase = {
				# ãã®ä»–
				"ã‚ã„ã†"=>false,
				"ã“ã‚“"=>true,
				"ã»ãƒ¼ã„"=>false,
				"ãŸã ã„ã¾ã‹ã‚‰å¾©æ´»è–¬ã‚’ç ´æ ¼ã®..."=>false,
				"ãªã£"=>false,
				# ã“ã‚“ãªã©
				"ã‹ã°ã‚“ã•ã‚“ã“ã‚“ã§ã™ãƒ¼"=>true,
				"ã‚¢ã‚¤ã‚³ãƒ³"=>false,
				"ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿"=>false,
				"ã©ã†ã‚‚ãƒ¼"=>true,
				"ã¡ã‚ãƒ¼"=>true,
				# å¯ã¾ã™ç³»çµ±
				"ã»ã©ã»ã©ã§å¯ã¾ã™ï½—"=>false,
				"å¯ã¾ã™"=>true,
				"ã­ã‚‹ã­"=>true,
				"ã­ã‚‹ã­ãƒ¼"=>true,
				"ã­ã‚‹ã­ã‚‹ã­ã‚‹ã­"=>false,
				"ãƒãƒ£ãƒ³ãƒãƒ«"=>false,
				"ã¤ã„ã§ã«å®£ä¼ã‚‚ã‹ã­ã¦(ã‰ãƒ"=>false,
				"çœ ã„ã®ã§è«¦ã‚ã‚‹"=>true,
				"çœ ã„ã—è«¦ã‚"=>true,
				"ã­ã‚€ã„ã®ã§ã‚ãã‚‰ã‚ãƒ»ãƒ»"=>true,
				"çœ ã„ã‘ã©é ‘å¼µã‚‹"=>false,
				"ã‚ãƒ¼ã€è«¦ã‚ãŸ"=>false,
				# ãŠã¤ã‹ã‚Œç³»çµ±
				"è¿½ã„ã¤ã‹ã‚ŒãŸã‚“ã˜ã‚ƒï¼Ÿ"=>false,
				"ãŠã¤ã‹ã‚Œ"=>true,
				"ã ã£ãŸã‚‰ãŠç–²ã‚Œã£ã¦æ„Ÿã˜â€¦ï¼Ÿ"=>false,
				"å›å¾©è–¬ã®ä¾¡æ ¼ãŒè½ã¡ã‚‹ã‹ãª"=>false,
				"ã‚‚ã†ã¤ã‹ã‚Œã¾ã—ãŸ"=>true,
				"çœ ã„ã—è½ã¡ã‚‹ãƒ»ãƒ»"=>true,
				# è¡Œã£ã¦ãã¾ã™ç³»çµ±
				"å¥ªã„è¿”ã—ã«è¡Œãã‹ã‚‰ãª"=>false,
				"ã‚ã€ã‚“ã˜ã‚ƒãã£ã¡ã«ã„ãã­"=>true,
				"é£¯è½ã¡"=>true,
				"è¡Œãã‹è¡Œã‹ãªã„ã‹"=>false,
				"ã‚ãƒ¼ã€è¡Œã"=>true,
				"ã‚ãƒ¼ã€ã„ã"=>true,
				"ã§ã¯ã„ã£ã¦ãã¾ã™"=>true,
				"è¡Œãã‹ããƒ»ãƒ»"=>true,
				"ã„ãã‹ããƒ»ãƒ»"=>true,
				"è¡Œãã­"=>true,
				"ã„ãã­"=>true,
				"ã‚“ã€è¡Œããƒ¼"=>true,
				"ã‚“ã€ã„ããƒ¼"=>true,
				"ã‚ã€äº†è§£ã€‚ã‚“ã˜ã‚ƒä»Šã‹ã‚‰è¡Œãã¾ã™ã­"=>true,
				"ãŠé¢¨å‘‚è¡Œã£ã¦ãã¾ã™"=>true,
				"ã‚“ã˜ã‚ƒè‡ªåˆ†ãŒãã£ã¡ã«è¡Œãã¾ã™ã­"=>true,
				"ã‚ãƒ¼ã€æ˜æ—¥ã„ãã‹ãƒ»ãƒ»"=>false,
				"ã‚ã€æ˜å¾Œæ—¥ã„ãã®ã­ã€‚äº†è§£"=>false,
				"ã‚ã€è¡Œããƒ¼"=>true,
				"ã‚ã€ã„ããƒ¼"=>true,
				"æ˜¨æ—¥è¡Œã£ãŸã¨ã“ã‚ã¯ã‚ˆã‹ã£ãŸã‚ˆã­"=>false,
				"æ˜¨æ—¥è¡Œãç´„æŸã ã£ãŸã‚ˆã­ï¼Ÿ"=>false,
				"æ˜æ—¥è¡Œãç´„æŸãªã‚“ã ã‘ã©ã­"=>false,
				"è¡Œã£ã¦ãã¾ã™"=>true,
				"ã‚¤ãƒƒãƒ†ãƒ«ãƒ“ã‚¦ãƒ "=>false,
				"è¡Œã"=>true,
				"ã„ã"=>true,
				"ãƒã‚¤ã‚¯"=>false,
				"ãƒã‚¤ã‚¯ãƒ©"=>false,
				"ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆ"=>false,
				"ã„ãã‚‰"=>false,
				"æ•µã‹ã‚‰æ¾ã‚Šå–ã£ã¦ã„ãã‚¹ã‚¿ã‚¤ãƒ«()"=>false,
				"ãƒ¢ã‚¶ã‚¤ã‚¯"=>false,
				"ãã‚“ã„ã‚ãƒ¢ã‚¶ã‚¤ã‚¯"=>false,
				"ãã‚Šã‚ƒè¡Œãã«ãã¾ã£ã¦ã‚‹ã‚ˆ"=>false,
				"ãã‚Šã‚ƒã„ãã«ãã¾ã£ã¦ã‚‹ã‚ˆ"=>false,
				"ã‚ã£ã€ä»Šã‹ã‚‰è¡Œãã­"=>true,
				"ã‚ã£ã€ä»Šã‹ã‚‰ã„ãã­"=>true,
				"æŒã£ã¦ã„ã"=>false,
				"ã¨ã£ã¦ã„ãã¾ã™ã­"=>false,
				"ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆ"=>false,
				"ãã—ã¦å…¨å“¡ã‚ã¦ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãŒç„¡äº‹è¡Œãã¨ãƒ»ãƒ»ãƒ»"=>false,
				"ã„ãã¤ã‹ã®æ–¹æ³•ã§èª¿ã¹ã¦ã¿ã‚‹"=>false,
				"å¹´é–“ã«ã™ã‚‹ã¨5000å††ãã‚‰ã„è¡Œãã‹..."=>false,
				"æœˆæ›œã¯å­¦æ ¡è¡Œãã‘ã©"=>false,
				"ã‚³ãƒ³ãƒ“ãƒ‹è¡Œã£ã¦ãã‚‹"=>true,
				"ä¸€é€±é–“å¾Œè¡Œãã‹ãªã"=>false,
				"ä¸€é€±é–“å¾Œã«è¡Œãã‹ãªã"=>false,
				"ã‚³ãƒ³ãƒ“ãƒ‹ã«è¡Œãã‹ãªããƒ»ãƒ»ãã‚Œã¨ã‚‚è¡Œã‹ãªã„ã‹ãªã"=>false,
				"ã†ãƒ¼ã‚“è¡Œãã‹"=>true,
				"ã‚„ã£ã¨è¡Œãã®ã‹"=>false,
				"ã‚„ã£ã¨â—‹â—‹ã«è¡Œãã®ã‹"=>false,
				"ã‚³ãƒ³ãƒ“ãƒ‹ã«è¡Œãã‹"=>true,
				"ã‚³ãƒ³ãƒ“ãƒ‹ã«ã„ã£ã¦ãã‚‹"=>true,
				"ã“ã‚Œã§ã„ãã‚"=>false,
				"è»Šã§è¡Œã£ã¦ãã‚‹"=>false,
				"è»Šã§å‡ºã‹ã‘ã¦ãã‚‹"=>true,
				"â—‹â—‹ã¡ã‚ƒã‚“ã¨ãŠå‡ºã‹ã‘ãƒ¼!"=>false,
				"ã§ã‹ã‘ã¦ãã¾ã™ã‚“"=>true,
				# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä»¥ä¸Š
			}
			sel = testcase
				.map{|s,e|[s,e,!!(find_case(cases, s)) == e]}
				.select{|s,e,r|!r}
			["ãƒ†ã‚¹ãƒˆ\n"+
				((sel.empty?)? "ã™ã¹ã¦æˆåŠŸ å…¨#{testcase.length}ãƒ‘ã‚¿ãƒ¼ãƒ³" : (sel
					.map{|s,e,r|"#{s}\n\tæœŸå¾… : #{e}"}
					.join("\n")))]
		}},
]

# ã‚¹ã‚­ãƒƒãƒ—ç”¨å‰å‡¦ç†
cases.each{|h|h[:last_greeting] = {}; h[:last_time_res] = {}}

bot.message{|e|
	msg = e.content
	isdebug = msg =~ /\Ad-/
	hour = (msg =~ /\Ad-\d+/)? msg.match(/\Ad-(\d+)/)[1].to_i : nil
	msg = msg.gsub(/\Ad-\d*/){""} if isdebug
	puts msg+" : ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã€‚skipåˆ¤å®šã‚’é£›ã°ã—ã¾ã™" if isdebug
	
	match = find_case(cases, msg)
	puts "\nregexp : #{match[:r]}" if isdebug && !!match
	
	if match.nil?
		puts "#{msg} => (ãƒãƒƒãƒã—ã¾ã›ã‚“ã§ã—ãŸ)" if isdebug
		next
	end
	
	# ã“ã‚Œã‚ˆã‚Šå¾Œã«ã—ãªã„ã¨ã„ã‚‰ãªã„æ™‚ã¾ã§å‡ºåŠ›ã™ã‚‹ãŸã‚
	# ä¸Šã®éƒ¨åˆ†ãŒæ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦æ¥ãŸã‚‰ã¾ãŸè€ƒãˆã‚‹
	unless bot.profile.on(e.server).permission?(:send_messages, e.channel)
		puts "#{msg} => (#{e.server.name}ã®#{e.channel.name}ã§ã¯botã®æ¨©é™ãŒè¶³ã‚Šãªã„ãŸã‚ã‚«ãƒƒãƒˆ)"
		next
	end
	if match[:last_greeting].key?(e.channel.id) && (!isdebug && (Time.now-match[:last_greeting][e.channel.id]) <= match[:skip])
		puts "#{msg} => (#{e.server.name}ã®#{e.channel.name}ã§ã¯å‰å›ã®æŒ¨æ‹¶ã‹ã‚‰#{match[:skip]}ç§’ä»¥å†…ã®ãŸã‚ã‚«ãƒƒãƒˆ)"
		next
	end
	if e.author.bot_account?
		puts "#{msg} => (botã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãŸã‚ã‚«ãƒƒãƒˆ)"
		next
	end
	if msg.length>50
		puts "#{msg} => (50æ–‡å­—ã‚’è¶…ãˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãŸã‚ã‚«ãƒƒãƒˆ)"
		next
	end
	if msg.count("`") >= 2
		puts "#{msg} => (ãƒãƒƒã‚¯ã‚¯ã‚ªãƒ¼ãƒˆãŒ2ã¤ä»¥ä¸Šå«ã¾ã‚Œã‚‹ãŸã‚ã‚«ãƒƒãƒˆ)"
		next
	end
	
	match[:last_greeting][e.channel.id] = Time.now
	
	nowtime = (isdebug && hour)? Time.local(2000, nil, nil, hour) : Time.now
	puts "#{nowtime}ã¨ã—ã¦å®Ÿè¡Œ"
	ress = match[:res].(nowtime)
	res = loop{
		res = ress[rand(0..ress.length-1)]
		if res!=match[:last_time_res][e.channel.id] || ress.length<=1
			break res
		end
	}
	match[:last_time_res][e.channel.id] = res
	
	puts msg+" => "+res
	e.respond res
}

bot.ready{|e|bot.game = "æŒ¨æ‹¶bot|n.help"}

bot.server_create{|e|
	(e.server.default_channel||e.server.text_channels.first)
		.send_message(
			"#{find_case(cases, "ã“ã‚“ã«ã¡ã¯")[:res].(Time.now).sample}ã€‚è©³ã—ãã¯`n.help`ã«ã¦ï¼\n\n"+
			"This bot does job only in Japanese text."
		)
}

bot.run :async

puts find_case(cases, "n.test")[:res].(Time.now).sample # æ­£è¦è¡¨ç¾ã‚’ä½œã‚‹ã®ã«ã‚ã‚‹ç¨‹åº¦ã®æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚

bot.sync
